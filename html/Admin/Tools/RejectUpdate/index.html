<& /Admin/Elements/Header, Title => $title &>
<& /Elements/Tabs &>

<& /Elements/ListActions, actions => \@results &>

<& Elements/CollectionTable, headers => $table_headers, rows => $table_rows &>

<%init>
my $title = loc('Reject ticket configuration');
unless ($session{'CurrentUser'}->HasRight( Object=> $RT::System, Right => 'SuperUser')) {
    Abort(loc('This feature is only available to system administrators'));
}

use Data::Dumper qw(Dumper);

my $config = RT::Extension::RejectUpdate::load_config;
my @results;

# Fill data for CollectionTable
my $table_rows = [];
my $table_headers = ['#', 'Name', 'Reject fields', 'Enabled'];
my $i = 0;
while (defined($config->[$i])) {
    push @$table_rows, {
        'link' => '/Admin/Tools/RejectUpdate/edit.html?id=' . $i,
        'cols' => [
            $i,
            $config->[$i]->{'rulename'},
            (join ', ', map {$_->{'field'}} @{$config->[$i]->{'rfields'}}),
            ($config->[$i]->{'enabled'} ? 'Enabled' : 'Disabled') #loc
        ],
    };
    $i++;
}
</%init>
