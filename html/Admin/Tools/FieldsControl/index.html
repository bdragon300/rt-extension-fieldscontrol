<& /Admin/Elements/Header, Title => $title &>
<& /Elements/Tabs &>

<& /Elements/ListActions, actions => \@results &>

<& Elements/CollectionTable, headers => $table_headers, rows => $table_rows &>

<%init>
my $title = loc('FieldsControl configuration');
unless ($session{'CurrentUser'}->HasRight( Object=> $RT::System, Right => 'SuperUser')) {
    Abort(loc('This feature is only available to system administrators'));
}

use Data::Dumper qw(Dumper);

my $config = RT::Extension::FieldsControl::load_config;
my @results;

# Fill data for CollectionTable
my $table_rows = [];
my $table_headers = [loc('#'), loc('Name'), loc('Checking fields'), loc('Status')];

my $i = 0;
while (defined($config->[$i])) {
    push @$table_rows, {
        'link' => '/Admin/Tools/FieldsControl/edit.html?id=' . $i,
        'cols' => [
            $i,
            $config->[$i]->{'rulename'},
            (join ', ', map {loc($_->{'field'})} @{$config->[$i]->{'rfields'}}),
            ($config->[$i]->{'enabled'} ? loc('Enabled') : loc('Disabled')) #loc
        ],
    };
    $i++;
}
</%init>
